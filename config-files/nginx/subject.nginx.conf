# Configuration file

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    # Default error pages
    error_page 404 /404.html;
    error_page 500 /500.html;

    # Limit client body size
    client_max_body_size 8M;

    # Server block 1
    server {
        listen       80;
        server_name  example.com www.example.com;

        # Default error pages location
        location = /404.html {
            root /var/www/html;
        }

        location = /500.html {
            root /var/www/html;
        }

        # Route 1: Root directory
        location / {
            root   /var/www/html;
            index  index.html index.htm;
            autoindex off;
        }

        # Route 2: Redirection
        location /redirect-me {
            return 301 http://www.example.com/;
        }

        # Route 3: CGI execution for .php files
        location ~ \.php$ {
            root           /var/www/html;
            fastcgi_pass   unix:/run/php/php7.4-fpm.sock;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            include        fastcgi_params;
        }

        # Route 4: Accepting POST and GET methods
        location /form {
            root /var/www/html;
            limit_except GET POST { deny all; }
        }

        # Route 5: Directory with listing on
        location /uploads/ {
            root /var/www/html;
            autoindex on;
            client_body_temp_path /var/www/html/uploads/temp;
            client_body_in_file_only on;
        }

        # Route 6: Accept file uploads
        location /upload {
            root /var/www/html/uploads;
            limit_except GET POST { deny all; }
            client_max_body_size 20M;
        }
    }

    # Server block 2
    server {
        listen       8080;
        server_name  another-example.com;

        location / {
            root   /var/www/another-example;
            index  index.html index.htm;
            autoindex off;
        }

        location ~ \.py$ {
            root /var/www/another-example;
            fastcgi_pass   unix:/run/python/python3.8.sock;
            fastcgi_index  index.py;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            include        fastcgi_params;
        }
    }

    # Default server block
    server {
        listen       80 default_server;
        server_name  _;

        location / {
            root   /var/www/default;
            index  index.html index.htm;
            autoindex off;
        }
    }
}
